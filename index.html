<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca de Videojuegos</title>

  <!-- MATERIALIZE CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

  <!-- ICONOS GOOGLE -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- DATATABLES -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

 <style>

/* ========= FONDO DE PANTALLA COMPLETO ========= */
body {
    background:
      linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 30, 0.85)),
      url("https://images6.alphacoders.com/135/thumb-1920-1350907.png");
    background-size: cover;
    background-position: center;
    background-attachment: fixed; /* Mantiene el fondo fijo */
    color: #e0e0e0 !important;
    min-height: 100vh;
    margin: 0;
    padding: 0;
}

/* Título */
h3 {
  color: #64b5f6;
  text-shadow: 0px 0px 6px black;
}

/* ========= TABLA ========= */
table {
  background-color: rgba(20, 20, 25, 0.8) !important;
  color: white !important;
  border-radius: 8px;
  overflow: hidden;
}

table thead {
  background: rgba(0, 50, 120, 0.9) !important;
  color: white !important;
}

table tbody tr:hover {
  background-color: rgba(50, 100, 255, 0.3) !important;
}

/* Filas de DataTable */
table.striped > tbody > tr:nth-child(odd) {
  background-color: rgba(255, 255, 255, 0.05) !important;
}
table.striped > tbody > tr:nth-child(even) {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

/* ========= DATATABLES OSCURO ========= */
.dataTables_wrapper .dataTables_filter input {
  background: rgba(30, 30, 30, 0.8);
  color: white;
  border: 1px solid #0d47a1;
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
  background: rgba(25, 25, 25, 0.8) !important;
  color: white !important;
  border: 1px solid #0d47a1 !important;
}

.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
  background: #0d47a1 !important;
  color: white !important;
}

/* ========= BOTONES ========= */
.btn,
.btn-small,
.modal-close {
  background: #1565c0 !important;
}

.btn:hover,
.btn-small:hover,
.modal-close:hover {
  background: #1e88e5 !important;
}

/* ========= MODAL ========= */
.modal {
  background: rgba(20, 20, 25, 0.95) !important;
  color: white !important;
  border-radius: 10px;
}

.modal-footer {
  background: rgba(10, 10, 15, 0.95) !important;
}

.modal img {
  width: 100%;
  border-radius: 10px;
  margin-bottom: 15px;
}
</style>

</head>

<body>

  <div class="container catalogo-fondo">
    <h3 class="center-align">Biblioteca de Videojuegos</h3>

    <!-- TABLA -->
    <table id="miTabla" class="striped highlight centered">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Estudio</th>
          <th>Género</th>
          <th>Año</th>
          <th>Más información</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="center-align" style="margin-top: 20px;">
      <a href="crud.html" class="btn">
        <i class="material-icons left">edit</i>
        MODIFICAR REGISTROS
      </a>
    </div>
  </div>

  <!-- MODAL MATERIALIZE -->
  <div id="modalJuego" class="modal">
    <div class="modal-content">
      <h4 id="modalNombre"></h4>
      <img id="modalImg">
      <p><b>Estudio:</b> <span id="modalEstudio"></span></p>
      <p><b>Género:</b> <span id="modalGenero"></span></p>
      <p><b>Año:</b> <span id="modalAnio"></span></p>
      <p><b>Puntuación:</b> <span id="modalPuntuacion"></span>/10</p>
      <p><b>Plataformas:</b> <span id="modalPlataformas"></span></p>
      <h5>Resumen</h5>
      <p id="modalResumen"></p>

      <a id="modalGameplay" target="_blank" class="btn red">
        <i class="material-icons left">ondemand_video</i>
        Ver Gameplay
      </a>
    </div>

    <div class="modal-footer">
      <a class="modal-close waves-effect btn-flat">Cerrar</a>
    </div>
  </div>


  <!-- LIBRERÍAS -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- MATERIALIZE JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <!-- FIREBASE + JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDL6rQZ26lv8-HEXlVJaW8Xwc42FCKxgkA",
      authDomain: "bibliotecavideojuegos-9ff72.firebaseapp.com",
      projectId: "bibliotecavideojuegos-9ff72",
      storageBucket: "bibliotecavideojuegos-9ff72.firebasestorage.app",
      messagingSenderId: "405804750018",
      appId: "1:405804750018:web:2af7fea6bd66e3b54b175b",
      measurementId: "G-333PHWPRED"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const coleccion = collection(db, "mibd");

    let tabla;

    $(document).ready(() => {

      M.Modal.init(document.querySelectorAll('.modal'));

      tabla = $('#miTabla').DataTable({
        data: [],
        columns: [
          { data: 'nombre' },
          { data: 'estudio' },
          { data: 'genero' },
          { data: 'anio' },
          {
            data: null,
            render: row => `
              <button class="btn-small btnMasInfo" data-id="${row.id}">
                Ver más
              </button>
            `
          }
        ]
      });

      cargarDatos();

      async function cargarDatos() {
        const snapshot = await getDocs(coleccion);
        const datos = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));

        tabla.clear();
        tabla.rows.add(datos).draw();
      }

      $('#miTabla tbody').on("click", ".btnMasInfo", function () {
        const data = tabla.row($(this).parents("tr")).data();
        mostrarModal(data);
      });

    });

    function mostrarModal(data) {
      document.getElementById("modalImg").src = data.imagen;
      document.getElementById("modalNombre").innerText = data.nombre;
      document.getElementById("modalEstudio").innerText = data.estudio;
      document.getElementById("modalGenero").innerText = data.genero;
      document.getElementById("modalAnio").innerText = data.anio;
      document.getElementById("modalPuntuacion").innerText = data.puntuacion;
      document.getElementById("modalPlataformas").innerText = data.plataformas.join(", ");
      document.getElementById("modalResumen").innerText = data.resumen;
      document.getElementById("modalGameplay").href = data.gameplay;

      const modal = M.Modal.getInstance(document.getElementById("modalJuego"));
      modal.open();
    }

  </script>

</body>
</html>
